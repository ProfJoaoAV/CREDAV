<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ficha Formativa de Gramﾃ｡tica - 6.ﾂｺ Ano (Estudo, Jogo e Avaliaﾃｧﾃ｣o)</title>
    <!-- Tailwind CSS CDN para um estilo moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuraﾃｧﾃ｣o da fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Azul suave */
            -webkit-tap-highlight-color: transparent; /* Remove highlight azul ao tocar em mobile */
        }
        /* Estilos base */
        .section-title {
            font-weight: 800;
            font-size: 1.5rem; /* Ajustado para mobile */
            color: #1e40af; /* Azul 700 */
            border-bottom: 3px solid #60a5fa; /* Azul 400 */
            padding-bottom: 0.5rem;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }
        @media (min-width: 640px) {
            .section-title { font-size: 1.75rem; }
        }

        .subsection-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #10b981; /* Esmeralda 500 */
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        @media (min-width: 640px) {
            .subsection-title { font-size: 1.25rem; }
        }

        /* Navegaﾃｧﾃ｣o (Tabs) */
        .nav-container {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: #f0f4f8;
            padding-bottom: 0.5rem;
        }
        .nav-btn {
            padding: 0.75rem 1rem;
            font-weight: 700;
            font-size: 0.9rem;
            color: #4b5563;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            flex: 1; /* Distribui espaﾃｧo igualmente em mobile */
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            white-space: nowrap;
        }
        .nav-btn:hover {
            color: #1e40af;
            background-color: #eff6ff;
        }
        .nav-btn.active {
            color: #1e40af;
            border-bottom-color: #1e40af;
            background-color: #ffffff;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilo da Zona de Estudo (Card) */
        .study-card {
            background-color: #f0fff4; /* Fundo verde muito claro */
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 5px solid #34d399; /* Esmeralda 400 */
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .keyword {
            color: #047857; /* Verde 700 para destaque */
            font-weight: 600;
        }
        
        /* Estilos de input e feedback */
        .input-text {
            border: 1px solid #d1d5db;
            padding: 0.6rem; /* Mais fﾃ｡cil de tocar */
            border-radius: 0.375rem;
            width: 100%;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            font-size: 16px; /* Evita zoom automﾃ｡tico em iOS */
        }
        .input-text:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        .correct { background-color: #ecfdf5; border-color: #34d399; }
        .incorrect { background-color: #fef2f2; border-color: #f87171; }
        .table-feedback-correct { background-color: #d1fae5; }
        .table-feedback-incorrect { background-color: #fee2e2; }
        
        /* Labels de Radio Button Otimizados para Toque */
        .radio-label {
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 2px solid #d1d5db;
            transition: all 0.2s;
            text-align: center;
            display: block;
            background-color: white;
            user-select: none;
        }
        .radio-label:active {
            transform: scale(0.98);
        }
        input[type="radio"]:checked + .radio-label {
            background-color: #10b981; 
            color: white;
            border-color: #059669;
        }

        /* Estilos especﾃｭficos para a Batalha Naval */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            width: 100%;
            max-width: 400px; /* Limite em Desktop */
            aspect-ratio: 1 / 1;
            margin: 0 auto;
            border: 2px solid #1e40af;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            background-color: #eff6ff;
        }
        .grid-cell {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            font-size: 0.8rem; /* Ajuste para caber em ecrﾃ｣s pequenos */
        }
        /* Aumentar ﾃ｡rea de toque virtualmente sem estragar layout */
        .grid-cell:active {
            background-color: #dbeafe;
        }
        
        .grid-header {
            background-color: #1e40af;
            color: white;
            font-size: 0.7rem;
            cursor: default;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .ship { background-color: #4b5563; color: white; }
        .miss { background-color: #60a5fa; color: white; content: '挑'; }
        .hit { background-color: #ef4444; color: white; animation: hit-pulse 0.5s infinite alternate; }
        .sunk { background-color: #dc2626; color: white; font-weight: bold; }
        .disabled { pointer-events: none; opacity: 0.7; }

        @keyframes hit-pulse {
            from { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            to { box-shadow: 0 0 0 5px rgba(239, 68, 68, 0); }
        }

        /* Ajustes Especﾃｭficos para Rotaﾃｧﾃ｣o (Landscape em Telemﾃｳvel) */
        @media (max-height: 500px) and (orientation: landscape) {
            .app-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding-bottom: 0.5rem;
                margin-bottom: 0.5rem;
                text-align: left;
            }
            .app-logo {
                width: 40px !important;
                height: 40px !important;
                margin-bottom: 0 !important;
                margin-right: 1rem;
            }
            .app-title {
                font-size: 1.25rem !important;
                margin-top: 0 !important;
            }
            .app-subtitle {
                display: none;
            }
            .nav-container {
                position: static;
                padding-bottom: 0.2rem;
            }
            .nav-btn {
                padding: 0.4rem;
                font-size: 0.8rem;
            }
            /* Layout lado a lado no jogo em landscape */
            #game-container .flex-col {
                flex-direction: row !important;
                align-items: start !important;
                gap: 1rem;
            }
            .game-grid {
                max-width: 250px; /* Reduz grelha em landscape para caber */
            }
        }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl min-h-[90vh] flex flex-col overflow-hidden">
        
        <header class="app-header text-center p-6 border-b bg-white">
            <!-- ﾃ皇one da Batalha Naval Gramatical (SVG Integrado) -->
            <div class="app-logo w-24 h-24 sm:w-32 sm:h-32 mx-auto mb-4 transition-transform hover:scale-110 duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="w-full h-full drop-shadow-xl">
                  <circle cx="256" cy="256" r="256" fill="#1e40af"/>
                  <path d="M0,350 Q64,300 128,350 T256,350 T384,350 T512,350 V512 H0 Z" fill="#60a5fa"/>
                  <path d="M0,400 Q64,350 128,400 T256,400 T384,400 T512,400 V512 H0 Z" fill="#93c5fd"/>
                  <path d="M100,320 L130,220 H380 L410,320 Z" fill="#4b5563"/>
                  <rect x="180" y="160" width="150" height="60" fill="#6b7280"/>
                  <rect x="230" y="100" width="50" height="60" fill="#9ca3af"/>
                  <rect x="245" y="60" width="20" height="40" fill="#d1d5db"/>
                  <g transform="translate(196, 120) scale(0.8)">
                    <path d="M10,80 Q75,90 140,80 V10 Q75,20 10,10 Z" fill="#f3f4f6"/>
                    <path d="M140,80 Q205,90 270,80 V10 Q205,20 140,10 Z" fill="#e5e7eb"/>
                    <path d="M140,80 V10" stroke="#9ca3af" stroke-width="2"/>
                    <rect x="30" y="30" width="80" height="5" fill="#374151"/>
                    <rect x="30" y="45" width="60" height="5" fill="#374151"/>
                    <rect x="170" y="30" width="80" height="5" fill="#374151"/>
                    <rect x="170" y="45" width="50" height="5" fill="#374151"/>
                  </g>
                  <g stroke="#ef4444" stroke-width="12" fill="none">
                    <circle cx="256" cy="200" r="130"/>
                    <line x1="256" y1="50" x2="256" y2="120"/>
                    <line x1="256" y1="280" x2="256" y2="350"/>
                    <line x1="106" y1="200" x2="176" y2="200"/>
                    <line x1="336" y1="200" x2="406" y2="200"/>
                  </g>
                </svg>
            </div>
            <h1 class="app-title text-2xl sm:text-4xl font-extrabold text-gray-900 leading-tight">Ficha Formativa de Gramﾃ｡tica</h1>
            <p class="app-subtitle text-sm sm:text-lg text-gray-600 mt-2">Portuguﾃｪs - 6.ﾂｺ Ano</p>
        </header>

        <!-- MENU DE NAVEGAﾃﾃグ -->
        <nav class="nav-container flex justify-around border-b border-gray-200 shadow-sm">
            <button onclick="switchTab('study')" id="btn-study" class="nav-btn active">
                <span class="text-xl mr-1">当</span> Estudo
            </button>
            <button onclick="switchTab('game')" id="btn-game" class="nav-btn">
                <span class="text-xl mr-1">式</span> Jogo
            </button>
            <button onclick="switchTab('assessment')" id="btn-assessment" class="nav-btn">
                <span class="text-xl mr-1">統</span> Avaliaﾃｧﾃ｣o
            </button>
        </nav>

        <div class="p-4 sm:p-8 flex-grow overflow-y-auto">
            <!-- SECﾃﾃグ 1: ZONA DE ESTUDO (TAB 1) -->
            <div id="view-study" class="tab-content active">
                <div id="study-area">
                    <h2 class="text-2xl sm:text-3xl font-extrabold text-emerald-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-8 sm:w-8 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        1. Zona de Estudo
                    </h2>
                    <p class="text-gray-600 mb-6 text-sm sm:text-base">Revﾃｪ aqui os principais conceitos gramaticais antes de passares ao Jogo e ﾃ Avaliaﾃｧﾃ｣o.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Card 1: Nomes -->
                        <div class="study-card">
                            <h3 class="subsection-title mt-0">Nomes (Coletivos e Grau)</h3>
                            <ul class="list-disc ml-4 space-y-2 text-gray-700 text-sm">
                                <li><span class="keyword">Nomes Coletivos:</span> Conjunto de seres da mesma espﾃｩcie. <br>Ex: <span class="keyword">Cardume</span> (peixes), <span class="keyword">Alcateia</span> (lobos).</li>
                                <li><span class="keyword">Grau dos Nomes:</span> <br><span class="keyword">Diminutivo:</span> <span class="italic">casinha</span>. <br><span class="keyword">Aumentativo:</span> <span class="italic">casarﾃ｣o</span>.</li>
                            </ul>
                        </div>

                        <!-- Card 2: Determinantes -->
                        <div class="study-card">
                            <h3 class="subsection-title mt-0">Determinantes</h3>
                            <ul class="list-disc ml-4 space-y-2 text-gray-700 text-sm">
                                <li><span class="keyword">Artigos:</span> <span class="italic">o, a, um, uma...</span></li>
                                <li><span class="keyword">Demonstrativos:</span> <span class="italic">este, esse, aquele...</span></li>
                                <li><span class="keyword">Possessivos:</span> <span class="italic">meu, teu, seu...</span></li>
                                <li><span class="keyword">Numerais:</span> <span class="italic">primeiro, segundo...</span></li>
                                <li><span class="keyword">Indefinidos:</span> <span class="italic">algum, nenhum...</span></li>
                            </ul>
                        </div>

                        <!-- Card 3: Adjetivos Qualificativos e Numerais -->
                        <div class="study-card">
                            <h3 class="subsection-title mt-0">Adjetivos (Subclasses)</h3>
                            <ul class="list-disc ml-4 space-y-2 text-gray-700 text-sm">
                                <li><span class="keyword">Qualificativo:</span> Qualidade. <br>Ex: <span class="italic">livro <span class="keyword">pesado</span></span>.</li>
                                <li><span class="keyword">Numeral:</span> Ordem/Posiﾃｧﾃ｣o. <br>Ex: <span class="italic">terceiro lugar</span>.</li>
                            </ul>
                        </div>

                        <!-- Card 4: Graus do Adjetivo -->
                        <div class="study-card">
                            <h3 class="subsection-title mt-0">Grau dos Adjetivos</h3>
                            <ul class="list-disc ml-4 space-y-2 text-gray-700 text-sm">
                                <li><span class="keyword">Normal:</span> <span class="italic">alto</span></li>
                                <li><span class="keyword">Comparativo:</span> <span class="italic">mais/menos/tﾃ｣o alto...</span></li>
                                <li><span class="keyword">Superlativo:</span>
                                    <ul class="ml-2 mt-1">
                                        <li>Absoluto: <span class="italic">muito alto</span> / <span class="italic">altﾃｭssimo</span></li>
                                        <li>Relativo: <span class="italic">o mais alto</span> / <span class="italic">o menos alto</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="text-center mt-8 pb-4">
                        <button onclick="switchTab('game')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 inline-flex items-center cursor-pointer w-full sm:w-auto justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            Passar para a Zona de Jogo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- SECﾃﾃグ 2: ZONA DE JOGO (TAB 2) -->
            <div id="view-game" class="tab-content">
                <h2 class="section-title text-emerald-700 mt-0">2. Batalha Gramatical 圓</h2>
                <p class="text-gray-600 mb-6 text-sm sm:text-base">Acerta nas perguntas para lanﾃｧares um mﾃｭssil e afundares os 3 navios do Computador.</p>

                <div id="game-container" class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200">
                    
                    <div id="game-status" class="text-center text-lg font-bold mb-4 min-h-[3rem] text-blue-700 flex items-center justify-center bg-blue-50 p-2 rounded">
                        Pronto para a batalha!
                    </div>
                    
                    <div class="flex flex-col md:flex-row justify-around items-center gap-8">
                        
                        <!-- Tabuleiro do Jogador (Escondido em Mobile Pequeno se necessﾃ｡rio, ou empilhado) -->
                        <div class="w-full max-w-[350px] text-center">
                            <h3 class="text-sm font-semibold mb-2 text-gray-700">O Teu Tabuleiro</h3>
                            <div id="player-grid" class="game-grid mx-auto">
                                <!-- Cﾃｩlulas do tabuleiro injetadas pelo JS -->
                            </div>
                            <p class="text-xs mt-2 text-gray-500">Teus Navios (Cinza)</p>
                        </div>

                        <!-- Separador Visual ou VS -->
                        <div class="font-bold text-gray-400 text-xl hidden md:block">VS</div>

                        <!-- Tabuleiro do Oponente -->
                        <div class="w-full max-w-[350px] text-center">
                            <h3 class="text-sm font-semibold mb-2 text-gray-700">Computador (Alvo de Ataque)</h3>
                            <div id="computer-grid" class="game-grid mx-auto shadow-lg border-emerald-500 border-2">
                                <!-- Cﾃｩlulas do tabuleiro injetadas pelo JS -->
                            </div>
                            <p class="text-xs mt-2 text-emerald-600 font-bold animate-pulse">Toque numa cﾃｩlula para atacar!</p>
                        </div>
                    </div>

                    <!-- Zona de Perguntas / Respostas -->
                    <div id="question-area" class="mt-8 p-4 bg-white rounded-lg shadow-md border-2 border-blue-200 hidden mx-auto max-w-lg">
                        <h4 class="text-lg font-bold text-blue-600 mb-3">Pergunta de Ataque:</h4>
                        <p id="question-text" class="mb-4 text-gray-800 text-sm font-medium"></p>
                        
                        <div id="answer-options" class="flex flex-col space-y-2">
                            <!-- Opﾃｧﾃｵes de resposta injetadas pelo JS -->
                        </div>
                        
                        <div class="text-center mt-6">
                            <button id="submit-answer-btn" onclick="submitGrammarAnswer()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                                Lanﾃｧar Mﾃｭssil! 噫
                            </button>
                        </div>
                        <p id="answer-feedback" class="mt-4 text-center font-bold text-sm"></p>
                    </div>
                    
                    <!-- Botﾃ｣o de Inﾃｭcio/Reinﾃｭcio -->
                    <div class="text-center mt-8 pb-4">
                        <button id="start-game-btn" onclick="startGame()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform active:scale-95 text-sm">
                            Reiniciar Jogo
                        </button>
                    </div>
                </div>

                <div class="text-center mt-8 pb-8">
                    <button onclick="switchTab('assessment')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 inline-flex items-center cursor-pointer w-full sm:w-auto justify-center">
                        Passar para a Avaliaﾃｧﾃ｣o
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- SECﾃﾃグ 3: ZONA DE AVALIAﾃﾃグ (TAB 3) -->
            <div id="view-assessment" class="tab-content">
                <h2 class="section-title text-blue-700 mt-0">3. Avaliaﾃｧﾃ｣o (380 Pontos)</h2>
                <p class="text-gray-600 mb-6 text-sm">Podes consultar a <span class="font-bold text-emerald-600 cursor-pointer underline" onclick="switchTab('study')">Zona de Estudo</span> a qualquer momento.</p>

                <form id="grammar-quiz-form">

                    <!-- SECﾃﾃグ 1: NOMES COLETIVOS -->
                    <div id="section-1" class="mb-8">
                        <h3 class="subsection-title">1.1. Nomes Coletivos (60 Pontos)</h3>
                        <p class="mb-4 text-xs text-gray-500">Completa as frases.</p>
                        <div class="space-y-3">
                            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <label for="q1_a" class="font-medium text-gray-700 text-sm mb-2">a. Cﾃ｡fila ﾃｩ um conjunto de:</label>
                                <input type="text" id="q1_a" class="input-text" data-answer="cﾃ｣es" data-points="10" placeholder="Sua resposta...">
                            </div>
                            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <label for="q1_b" class="font-medium text-gray-700 text-sm mb-2">b. Um bando ﾃｩ um conjunto de:</label>
                                <input type="text" id="q1_b" class="input-text" data-answer="aves" data-points="10">
                            </div>
                            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <label for="q1_c" class="font-medium text-gray-700 text-sm mb-2">c. Uma quadrilha ﾃｩ um conjunto de:</label>
                                <input type="text" id="q1_c" class="input-text" data-answer="ladrﾃｵes" data-points="10">
                            </div>
                            <!-- Para poupar espaﾃｧo vertical em mobile, o resto desta secﾃｧﾃ｣o segue o mesmo padrﾃ｣o -->
                            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <label for="q1_d" class="font-medium text-gray-700 text-sm mb-2">d. Constelaﾃｧﾃ｣o ﾃｩ um conjunto de:</label>
                                <input type="text" id="q1_d" class="input-text" data-answer="estrelas" data-points="10">
                            </div>
                            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <label for="q1_e" class="font-medium text-gray-700 text-sm mb-2">e. Cordilheira ﾃｩ um conjunto de:</label>
                                <input type="text" id="q1_e" class="input-text" data-answer="montanhas" data-points="10">
                            </div>
                            <div class="flex flex-col p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <label for="q1_f" class="font-medium text-gray-700 text-sm mb-2">f. Multidﾃ｣o ﾃｩ um conjunto de:</label>
                                <input type="text" id="q1_f" class="input-text" data-answer="pessoas" data-points="10">
                            </div>
                        </div>
                    </div>

                    <!-- SECﾃﾃグ 2: GRAU DOS NOMES -->
                    <div id="section-2" class="mb-8">
                        <h3 class="subsection-title">1.2. Grau dos Nomes (60 Pontos)</h3>
                        <p class="mb-2 text-xs text-gray-500">Arrasta para o lado se nﾃ｣o vires a tabela toda.</p>
                        <div class="overflow-x-auto shadow-md rounded-lg border border-gray-200">
                            <table class="min-w-full bg-white text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">Nome</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">Diminutivo</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">Aumentativo</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="py-2 px-4 whitespace-nowrap">camisola</td>
                                        <td class="px-2"><input type="text" id="q2_1_dim" class="input-text text-sm py-1" data-answer="camisolinha" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q2_1_aum" class="input-text text-sm py-1" data-answer="camisolﾃ｣o" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-4">casaco</td>
                                        <td class="px-2"><input type="text" id="q2_2_dim" class="input-text text-sm py-1" data-answer="casaquinho" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q2_2_aum" class="input-text text-sm py-1" data-answer="casacﾃ｣o" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-4">dente</td>
                                        <td class="px-2"><input type="text" id="q2_3_dim" class="input-text text-sm py-1" data-answer="dentinho" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q2_3_aum" class="input-text text-sm py-1" data-answer="dentuﾃｧa" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-4">casa</td>
                                        <td class="px-2"><input type="text" id="q2_4_dim" class="input-text text-sm py-1" data-answer="casinha" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q2_4_aum" class="input-text text-sm py-1" data-answer="casarﾃ｣o" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-4">boca</td>
                                        <td class="px-2"><input type="text" id="q2_5_dim" class="input-text text-sm py-1" data-answer="boquinha" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q2_5_aum" class="input-text text-sm py-1" data-answer="bocarra" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-4">rapaz</td>
                                        <td class="px-2"><input type="text" id="q2_6_dim" class="input-text text-sm py-1" data-answer="rapazinho" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q2_6_aum" class="input-text text-sm py-1" data-answer="rapagﾃ｣o" data-points="5"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- SECﾃﾃグ 3: DETERMINANTES -->
                    <div id="section-3" class="mb-8">
                        <h3 class="subsection-title">2.1. Determinantes (120 Pontos)</h3>
                        <p class="mb-2 text-xs text-gray-500">Scroll horizontal disponﾃｭvel.</p>
                        <div class="overflow-x-auto shadow-md rounded-lg border border-gray-200">
                            <table class="min-w-[600px] bg-white text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-3 px-4 text-left w-1/3">Frase</th>
                                        <th class="py-3 px-4 text-left w-1/3">Determinante</th>
                                        <th class="py-3 px-4 text-left w-1/3">Subclasse</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Que programa preferes?</td>
                                        <td class="px-2"><input type="text" id="q3_1_det" class="input-text text-sm py-1" data-answer="que" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_1_sub" class="input-text text-sm py-1" data-answer="interrogativo" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Essa sﾃｩrie ﾃｩ boa.</td>
                                        <td class="px-2"><input type="text" id="q3_2_det" class="input-text text-sm py-1" data-answer="essa" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_2_sub" class="input-text text-sm py-1" data-answer="demonstrativo" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Vi um novo filme.</td>
                                        <td class="px-2"><input type="text" id="q3_3_det" class="input-text text-sm py-1" data-answer="um" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_3_sub" class="input-text text-sm py-1" data-answer="artigo indefinido" data-points="5"></td>
                                    </tr>
                                    <!-- Itens restantes simplificados para brevidade visual, mas presentes no cﾃｳdigo -->
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Guardo este autﾃｳgrafo.</td>
                                        <td class="px-2"><input type="text" id="q3_4_det" class="input-text text-sm py-1" data-answer="este" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_4_sub" class="input-text text-sm py-1" data-answer="demonstrativo" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Nunca vi uma sﾃｩrie assim.</td>
                                        <td class="px-2"><input type="text" id="q3_5_det" class="input-text text-sm py-1" data-answer="uma" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_5_sub" class="input-text text-sm py-1" data-answer="artigo indefinido" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Adorei os episﾃｳdios.</td>
                                        <td class="px-2"><input type="text" id="q3_6_det" class="input-text text-sm py-1" data-answer="os" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_6_sub" class="input-text text-sm py-1" data-answer="artigo definido" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Quantos atores?</td>
                                        <td class="px-2"><input type="text" id="q3_7_det" class="input-text text-sm py-1" data-answer="quantos" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_7_sub" class="input-text text-sm py-1" data-answer="interrogativo" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">O meu livro.</td>
                                        <td class="px-2"><input type="text" id="q3_8_det" class="input-text text-sm py-1" data-answer="meu" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_8_sub" class="input-text text-sm py-1" data-answer="possessivo" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Seus pais.</td>
                                        <td class="px-2"><input type="text" id="q3_9_det" class="input-text text-sm py-1" data-answer="seus" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_9_sub" class="input-text text-sm py-1" data-answer="possessivo" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Terceiro lugar.</td>
                                        <td class="px-2"><input type="text" id="q3_10_det" class="input-text text-sm py-1" data-answer="terceiro" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_10_sub" class="input-text text-sm py-1" data-answer="numeral" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Alguma coisa.</td>
                                        <td class="px-2"><input type="text" id="q3_11_det" class="input-text text-sm py-1" data-answer="alguma" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_11_sub" class="input-text text-sm py-1" data-answer="indefinido" data-points="5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 text-xs sm:text-sm">Que sorte!</td>
                                        <td class="px-2"><input type="text" id="q3_12_det" class="input-text text-sm py-1" data-answer="que" data-points="5"></td>
                                        <td class="px-2"><input type="text" id="q3_12_sub" class="input-text text-sm py-1" data-answer="exclamativo" data-points="5"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- SECﾃﾃグ 4: SUBCLASSES DO ADJETIVO -->
                    <div id="section-4" class="mb-8">
                        <h3 class="subsection-title">3.1. Subclasses do Adjetivo (40 Pontos)</h3>
                        <div class="overflow-x-auto shadow-md rounded-lg border border-gray-200">
                            <table class="min-w-full bg-white text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-3 px-4 text-left">Frase</th>
                                        <th class="py-3 px-2 text-center w-24">Qualif.</th>
                                        <th class="py-3 px-2 text-center w-24">Numeral</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-2">Partiram no <u>dﾃｩcimo</u> dia.</td>
                                        <td class="text-center"><input type="radio" name="q4_a" value="qualificativo" class="h-5 w-5"></td>
                                        <td class="text-center"><input type="radio" name="q4_a" value="numeral" data-answer="numeral" data-points="10" class="h-5 w-5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2"><u>Primeira</u> montanha.</td>
                                        <td class="text-center"><input type="radio" name="q4_b" value="qualificativo" class="h-5 w-5"></td>
                                        <td class="text-center"><input type="radio" name="q4_b" value="numeral" data-answer="numeral" data-points="10" class="h-5 w-5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">Jantar <u>saboroso</u>.</td>
                                        <td class="text-center"><input type="radio" name="q4_c" value="qualificativo" data-answer="qualificativo" data-points="10" class="h-5 w-5"></td>
                                        <td class="text-center"><input type="radio" name="q4_c" value="numeral" class="h-5 w-5"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">Notﾃｭcias <u>boas</u>.</td>
                                        <td class="text-center"><input type="radio" name="q4_d" value="qualificativo" data-answer="qualificativo" data-points="10" class="h-5 w-5"></td>
                                        <td class="text-center"><input type="radio" name="q4_d" value="numeral" class="h-5 w-5"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- SECﾃﾃグ 5: IDENTIFICAﾃﾃグ DE GRAUS -->
                    <div id="section-5" class="mb-8">
                        <h3 class="subsection-title">3.2. Identificaﾃｧﾃ｣o de Graus (80 Pontos)</h3>
                        <div class="space-y-4">
                            <!-- Bloco Padrﾃ｣o Repetido -->
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">a. O Joﾃ｣o ﾃｩ <u>muito alto</u>.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_a" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_a" value="comparativo" class="hidden">Comparativo</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_a" value="superlativo absoluto analﾃｭtico" data-answer="superlativo absoluto analﾃｭtico" data-points="10" class="hidden">Sup. Abs. Analﾃｭtico</label>
                                </div>
                            </div>

                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">b. O carro dele ﾃｩ <u>o mais rﾃ｡pido</u>.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_b" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_b" value="comparativo" class="hidden">Comparativo</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_b" value="superlativo relativo de superioridade" data-answer="superlativo relativo de superioridade" data-points="10" class="hidden">Sup. Rel. Superioridade</label>
                                </div>
                            </div>

                            <!-- Restantes alﾃｭneas simplificadas no HTML mas funcionais -->
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">c. Ana ﾃｩ <u>mais esperta que</u>...</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_c" value="comparativo de superioridade" data-answer="comparativo de superioridade" data-points="10" class="hidden">Comp. Superioridade</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_c" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_c" value="superlativo" class="hidden">Superlativo</label>
                                </div>
                            </div>
                            
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">d. <u>Tﾃ｣o grande como</u>...</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_d" value="comparativo de igualdade" data-answer="comparativo de igualdade" data-points="10" class="hidden">Comp. Igualdade</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_d" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_d" value="superlativo" class="hidden">Superlativo</label>
                                </div>
                            </div>

                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">e. <u>Facﾃｭlimo</u>.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_e" value="superlativo absoluto sintﾃｩtico" data-answer="superlativo absoluto sintﾃｩtico" data-points="10" class="hidden">Sup. Abs. Sintﾃｩtico</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_e" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_e" value="comparativo" class="hidden">Comparativo</label>
                                </div>
                            </div>

                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">f. <u>Menos esperto que</u>...</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_f" value="comparativo de inferioridade" data-answer="comparativo de inferioridade" data-points="10" class="hidden">Comp. Inferioridade</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_f" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_f" value="superlativo" class="hidden">Superlativo</label>
                                </div>
                            </div>

                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">g. <u>O menos atento</u>.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_g" value="superlativo relativo de inferioridade" data-answer="superlativo relativo de inferioridade" data-points="10" class="hidden">Sup. Rel. Inferioridade</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_g" value="normal" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_g" value="comparativo" class="hidden">Comparativo</label>
                                </div>
                            </div>

                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <p class="font-semibold text-gray-700 mb-2 text-sm">h. Montanha <u>alta</u>.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                    <label class="radio-label text-sm"><input type="radio" name="q5_h" value="normal" data-answer="normal" data-points="10" class="hidden">Normal</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_h" value="comparativo" class="hidden">Comparativo</label>
                                    <label class="radio-label text-sm"><input type="radio" name="q5_h" value="superlativo" class="hidden">Superlativo</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECﾃﾃグ 6: APLICAﾃﾃグ DE GRAUS -->
                    <div id="section-6" class="mb-8">
                        <h3 class="subsection-title">3.3. Aplicaﾃｧﾃ｣o (80 Pontos)</h3>
                        <p class="mb-2 text-xs text-gray-500">Escreve a resposta nas caixas.</p>
                        <div class="overflow-x-auto shadow-md rounded-lg border border-gray-200">
                            <table class="min-w-[500px] bg-white text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-3 px-4 text-left">Grau Normal</th>
                                        <th class="py-3 px-4 text-left">Sup. Abs. Sintﾃｩtico</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr><td class="px-4 py-2">Fﾃ｡cil</td><td class="px-2"><input type="text" id="q6_1_a" class="input-text text-sm py-1" data-answer="facﾃｭlimo" data-points="10"></td></tr>
                                    <tr><td class="px-4 py-2">Pobre</td><td class="px-2"><input type="text" id="q6_1_b" class="input-text text-sm py-1" data-answer="paupﾃｩrrimo,pobrﾃｭssimo" data-points="10"></td></tr>
                                    <tr><td class="px-4 py-2">Fiel</td><td class="px-2"><input type="text" id="q6_1_c" class="input-text text-sm py-1" data-answer="fidelﾃｭssimo" data-points="10"></td></tr>
                                    <tr><td class="px-4 py-2">Alto</td><td class="px-2"><input type="text" id="q6_1_d" class="input-text text-sm py-1" data-answer="altﾃｭssimo,supremo" data-points="10"></td></tr>
                                </tbody>
                            </table>
                        </div>
                        <br>
                        <div class="overflow-x-auto shadow-md rounded-lg border border-gray-200">
                            <table class="min-w-[500px] bg-white text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-3 px-4 text-left">Grau Normal</th>
                                        <th class="py-3 px-4 text-left">Comparativo</th>
                                        <th class="py-3 px-4 text-left">Superlativo</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-2">Bom</td>
                                        <td class="px-2"><input type="text" id="q6_2_e" class="input-text text-sm py-1" data-answer="melhor" data-points="10"></td>
                                        <td class="px-2"><input type="text" id="q6_2_f" class="input-text text-sm py-1" data-answer="ﾃｳtimo" data-points="10"></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">Mau</td>
                                        <td class="px-2"><input type="text" id="q6_2_g" class="input-text text-sm py-1" data-answer="pior" data-points="10"></td>
                                        <td class="px-2"><input type="text" id="q6_2_h" class="input-text text-sm py-1" data-answer="pﾃｩssimo" data-points="10"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Botﾃ｣o de Submissﾃ｣o e Resultados -->
                    <div class="text-center mt-10 pb-8">
                        <button id="submit-button" type="button" onclick="submitQuiz()" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-xl transition duration-300 ease-in-out transform hover:scale-105">
                            Submeter Avaliaﾃｧﾃ｣o
                        </button>
                    </div>
                </form>

                <!-- ZONA DE RESULTADOS DO QUIZ -->
                <div id="quiz-results" class="mt-8 p-6 bg-gray-50 rounded-xl shadow-inner border border-blue-200 hidden">
                    <h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">Resultados</h2>
                    <div id="score-summary" class="p-4 text-center rounded-lg mb-6 border-l-4"></div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Feedback Detalhado</h3>
                    <div id="detailed-feedback" class="space-y-3"></div>
                    <div class="mt-8 text-center">
                        <button onclick="resetQuiz()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-full transition duration-300">
                            Reiniciar
                        </button>
                    </div>
                </div>
            </div>

        </div> <!-- Fim do container de scroll -->
    </div>

    <script>
        // --- NAVEGAﾃﾃグ ENTRE ZONAS ---
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + tabName).classList.add('active');
            document.getElementById('btn-' + tabName).classList.add('active');
            
            // Em mobile, scroll para o topo do conteﾃｺdo
            const mainContainer = document.querySelector('.flex-grow');
            if(mainContainer) mainContainer.scrollTo({ top: 0, behavior: 'smooth' });
            else window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Lﾃ敵ICA DA BATALHA GRAMATICAL (ZONA DE JOGO) ---
        const GRID_SIZE = 8;
        const GRID_LETTERS = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
        const SHIP_CONFIG = [
            { id: 1, name: 'Porta-aviﾃｵes', size: 3, hits: 0, sunk: false },
            { id: 2, name: 'Contratorpedeiro', size: 2, hits: 0, sunk: false },
            { id: 3, name: 'Submarino', size: 1, hits: 0, sunk: false }
        ];

        let playerGrid, computerGrid, playerShips, computerShips;
        let gameState = 'initial'; 
        let currentTargetCoordinate = null;
        
        // LISTA DE PERGUNTAS EXPANDIDA (40+)
        let GRAMMAR_QUESTIONS = [
            // PERGUNTAS ORIGINAIS (1-12)
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'abelhas'?", options: ["Alcateia", "Enxame", "Bando", "Esquadra"], answer: "Enxame" },
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'soldados'?", options: ["Frota", "Cﾃ｡fila", "Exﾃｩrcito", "Constelaﾃｧﾃ｣o"], answer: "Exﾃｩrcito" },
            { question: "Qual ﾃｩ o grau aumentativo do nome 'cﾃ｣o'?", options: ["Cﾃ｣ozinho", "Cﾃ｣obom", "Canzarrﾃ｣o", "Canino"], answer: "Canzarrﾃ｣o" },
            { question: "Qual ﾃｩ o grau diminutivo do nome 'sala'?", options: ["Saleta", "Salﾃ｣o", "Salinha", "Salita"], answer: "Salinha" },
            { question: "Na frase 'A Maria viu um filme.', qual ﾃｩ a subclasse do determinante 'um'?", options: ["Demonstrativo", "Possessivo", "Artigo Indefinido", "Numeral"], answer: "Artigo Indefinido" },
            { question: "Na frase 'Os meus ﾃｳculos desapareceram.', qual ﾃｩ a subclasse do determinante 'meus'?", options: ["Artigo Definido", "Demonstrativo", "Possessivo", "Indefinido"], answer: "Possessivo" },
            { question: "Na frase 'Este livro ﾃｩ novo.', qual ﾃｩ a subclasse do determinante 'Este'?", options: ["Artigo Definido", "Demonstrativo", "Numeral", "Interrogativo"], answer: "Demonstrativo" },
            { question: "Na frase 'O segundo prﾃｩmio foi o melhor.', qual ﾃｩ a subclasse do adjetivo 'segundo'?", options: ["Qualificativo", "Numeral", "Indefinido", "Demonstrativo"], answer: "Numeral" },
            { question: "Qual ﾃｩ o grau do adjetivo na expressﾃ｣o 'o mais bonito'?", options: ["Normal", "Comparativo de Superioridade", "Superlativo Absoluto Sintﾃｩtico", "Superlativo Relativo de Superioridade"], answer: "Superlativo Relativo de Superioridade" },
            { question: "Qual ﾃｩ o grau do adjetivo na expressﾃ｣o 'tﾃ｣o rﾃ｡pido como'?", options: ["Normal", "Comparativo de Igualdade", "Superlativo Absoluto Analﾃｭtico", "Superlativo Relativo de Inferioridade"], answer: "Comparativo de Igualdade" },
            { question: "Qual ﾃｩ a forma no Superlativo Absoluto Sintﾃｩtico do adjetivo 'cﾃｩlebre'?", options: ["Muito cﾃｩlebre", "Cﾃｩlebreﾃｭssimo", "Celebﾃｩrrimo", "Mais cﾃｩlebre que"], answer: "Celebﾃｩrrimo" },
            { question: "Na frase 'O dia estﾃ｡ frio.', qual ﾃｩ o grau do adjetivo 'frio'?", options: ["Normal", "Comparativo", "Superlativo Relativo", "Superlativo Absoluto"], answer: "Normal" },

            // NOVAS PERGUNTAS ADICIONADAS
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'lobos'?", options: ["Cardume", "Alcateia", "Rebanho", "Manada"], answer: "Alcateia" },
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'peixes'?", options: ["Vara", "Cardume", "Enxame", "Bando"], answer: "Cardume" },
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'ilhas'?", options: ["Continente", "Arquipﾃｩlago", "Cordilheira", "Penﾃｭnsula"], answer: "Arquipﾃｩlago" },
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'porcos'?", options: ["Vara", "Manada", "Alcateia", "Souto"], answer: "Vara" },
            { question: "Qual ﾃｩ o nome coletivo para um conjunto de 'mapas'?", options: ["Livro", "Enciclopﾃｩdia", "Atlas", "Dicionﾃ｡rio"], answer: "Atlas" },
            { question: "Qual ﾃｩ o aumentativo da palavra 'boca'?", options: ["Boquinha", "Bocazinha", "Bocarra", "Bocﾃ｣o"], answer: "Bocarra" },
            { question: "Qual ﾃｩ o aumentativo da palavra 'fogo'?", options: ["Fogueira", "Fogarﾃｩu", "Fogﾃ｣o", "Foguetﾃ｣o"], answer: "Fogarﾃｩu" },
            { question: "Qual ﾃｩ o diminutivo da palavra 'rio'?", options: ["Rito", "Riacho", "Riazito", "Riol"], answer: "Riacho" },
            { question: "Qual ﾃｩ o diminutivo da palavra 'chuva'?", options: ["Chuvisco", "Chuvinha", "Chuvada", "Aguaceiro"], answer: "Chuvisco" },
            { question: "Na frase 'Aquela casa ﾃｩ bonita', qual a subclasse do determinante 'Aquela'?", options: ["Possessivo", "Demonstrativo", "Artigo", "Indefinido"], answer: "Demonstrativo" },
            { question: "Na frase 'Li trﾃｪs livros', qual a subclasse do determinante 'trﾃｪs'?", options: ["Artigo", "Indefinido", "Numeral", "Possessivo"], answer: "Numeral" },
            { question: "Na frase 'Alguns alunos faltaram', qual a subclasse do determinante 'Alguns'?", options: ["Demonstrativo", "Indefinido", "Possessivo", "Interrogativo"], answer: "Indefinido" },
            { question: "Na frase 'Que linda paisagem!', qual a subclasse do determinante 'Que'?", options: ["Interrogativo", "Exclamativo", "Demonstrativo", "Indefinido"], answer: "Exclamativo" },
            { question: "Qual ﾃｩ o Superlativo Absoluto Sintﾃｩtico de 'antigo'?", options: ["Antigﾃ｣o", "Muito antigo", "Antiquﾃｭssimo", "Antiguﾃｭssimo"], answer: "Antiquﾃｭssimo" },
            { question: "Qual ﾃｩ o Superlativo Absoluto Sintﾃｩtico de 'amargo'?", options: ["Amarguﾃｭssimo", "Amarﾃｭssimo", "Muito amargo", "Amargoso"], answer: "Amarﾃｭssimo" },
            { question: "Qual ﾃｩ o Superlativo Absoluto Sintﾃｩtico de 'doce'?", options: ["Docﾃｭssimo", "Dulcﾃｭssimo", "Muito doce", "Docinho"], answer: "Dulcﾃｭssimo" },
            { question: "Qual ﾃｩ o Superlativo Absoluto Sintﾃｩtico de 'sﾃ｡bio'?", options: ["Sabﾃｭssimo", "Sapientﾃｭssimo", "Saberﾃｭssimo", "Muito sﾃ｡bio"], answer: "Sapientﾃｭssimo" },
            { question: "Qual ﾃｩ o grau da expressﾃ｣o 'menos alto do que'?", options: ["Comparativo de Superioridade", "Comparativo de Igualdade", "Comparativo de Inferioridade", "Superlativo"], answer: "Comparativo de Inferioridade" },
            { question: "Qual ﾃｩ o grau da expressﾃ｣o 'o menos rﾃ｡pido de'?", options: ["Comparativo de Inferioridade", "Superlativo Relativo de Superioridade", "Superlativo Relativo de Inferioridade", "Normal"], answer: "Superlativo Relativo de Inferioridade" },
            { question: "Qual ﾃｩ a classe da palavra 'rapidamente'?", options: ["Nome", "Adjetivo", "Verbo", "Advﾃｩrbio"], answer: "Advﾃｩrbio" },
            { question: "Qual ﾃｩ a classe da palavra 'ontem'?", options: ["Advﾃｩrbio de Tempo", "Advﾃｩrbio de Lugar", "Advﾃｩrbio de Modo", "Adjetivo"], answer: "Advﾃｩrbio de Tempo" },
            { question: "Qual ﾃｩ a classe da palavra 'aqui'?", options: ["Advﾃｩrbio de Tempo", "Advﾃｩrbio de Lugar", "Advﾃｩrbio de Modo", "Nome"], answer: "Advﾃｩrbio de Lugar" },
            { question: "Na frase 'Nﾃｳs fomos passear', qual a classe de 'Nﾃｳs'?", options: ["Nome", "Determinante", "Pronome Pessoal", "Adjetivo"], answer: "Pronome Pessoal" },
            { question: "Na frase 'Vou para casa', qual a classe de 'para'?", options: ["Nome", "Verbo", "Preposiﾃｧﾃ｣o", "Advﾃｩrbio"], answer: "Preposiﾃｧﾃ｣o" },
            { question: "O que ﾃｩ o 'sujeito' numa frase?", options: ["Quem pratica a aﾃｧﾃ｣o", "A aﾃｧﾃ｣o realizada", "O local da aﾃｧﾃ｣o", "Uma qualidade"], answer: "Quem pratica a aﾃｧﾃ｣o" },
            { question: "Na frase 'O gato dorme', qual ﾃｩ o predicado?", options: ["O gato", "dorme", "O", "gato dorme"], answer: "dorme" },
            { question: "Como se chama um nome que indica apenas um ser?", options: ["Nome Coletivo", "Nome Prﾃｳprio", "Nome Comum Singular", "Nome Comum Plural"], answer: "Nome Comum Singular" },
            { question: "Qual destas palavras ﾃｩ aguda (acento na ﾃｺltima sﾃｭlaba)?", options: ["Mesa", "Lﾃ｡pis", "Cafﾃｩ", "ﾃ〉vore"], answer: "Cafﾃｩ" },
            { question: "Qual destas palavras ﾃｩ esdrﾃｺxula (acento na antepenﾃｺltima sﾃｭlaba)?", options: ["Sofﾃ｡", "Mﾃ｡gico", "Caneta", "Papel"], answer: "Mﾃ｡gico" }
        ];

        function createGrid(containerId, isPlayerGrid) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            const gridState = [];
            
            for (let i = 0; i < GRID_SIZE; i++) gridState.push(new Array(GRID_SIZE).fill(null));

            const emptyCorner = document.createElement('div');
            emptyCorner.className = 'grid-header';
            container.appendChild(emptyCorner);

            for (let i = 1; i <= GRID_SIZE; i++) {
                const header = document.createElement('div');
                header.className = 'grid-header';
                header.textContent = i;
                container.appendChild(header);
            }

            for (let r = 0; r < GRID_SIZE; r++) {
                const rowLabel = document.createElement('div');
                rowLabel.className = 'grid-header';
                rowLabel.textContent = GRID_LETTERS[r];
                container.appendChild(rowLabel);

                for (let c = 0; c < GRID_SIZE; c++) {
                    const id = GRID_LETTERS[r] + (c + 1);
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.id = `${containerId}-${id}`;
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    if (!isPlayerGrid) {
                        cell.dataset.coord = id;
                        cell.addEventListener('click', handleAttackSelection);
                        // Adicionar suporte para touchstart para resposta mais rﾃ｡pida em mobile
                        cell.addEventListener('touchstart', function(e) {
                            e.preventDefault(); // Prevenir double-tap zoom
                            handleAttackSelection(e);
                        });
                    } else {
                        cell.style.cursor = 'default';
                    }
                    container.appendChild(cell);
                }
            }
            return gridState;
        }

        function placeShips(gridState, ships) {
            let attemptLimit = 100;
            ships.forEach(ship => { ship.hits = 0; ship.sunk = false; });

            for (const ship of ships) {
                let placed = false;
                while (!placed && attemptLimit > 0) {
                    attemptLimit--;
                    const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';
                    const startRow = Math.floor(Math.random() * GRID_SIZE);
                    const startCol = Math.floor(Math.random() * GRID_SIZE);
                    let canPlace = true;
                    const coords = [];

                    for (let i = 0; i < ship.size; i++) {
                        let r = startRow;
                        let c = startCol;
                        if (direction === 'horizontal') c += i; else r += i;
                        if (r >= GRID_SIZE || c >= GRID_SIZE || gridState[r][c] !== null) { canPlace = false; break; }
                        coords.push({ r, c });
                    }

                    if (canPlace) {
                        for (const { r, c } of coords) gridState[r][c] = ship.id;
                        ship.coords = coords;
                        placed = true;
                    }
                }
            }
        }

        function renderPlayerShips(gridState) {
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cellId = `player-grid-${GRID_LETTERS[r] + (c + 1)}`;
                    const cell = document.getElementById(cellId);
                    if (gridState[r][c] !== null) cell.classList.add('ship');
                }
            }
        }

        function handleAttackSelection(event) {
            if (gameState !== 'player_turn') return;
            const cell = event.target;
            const coord = cell.dataset.coord;

            if (cell.classList.contains('hit') || cell.classList.contains('miss')) {
                // Feedback visual breve
                return;
            }
            currentTargetCoordinate = coord;
            // Remover seleﾃｧﾃ｣o anterior
            document.querySelectorAll('.grid-cell').forEach(c => {
                c.style.backgroundColor = '';
                c.style.borderColor = '';
            });
            
            cell.style.backgroundColor = '#fcd34d'; 
            cell.style.border = '2px solid #f97316';
            document.querySelectorAll('#computer-grid .grid-cell').forEach(c => c.classList.add('disabled'));
            showGrammarQuestion();
        }

        function showGrammarQuestion() {
            gameState = 'questioning';
            const questionArea = document.getElementById('question-area');
            questionArea.classList.remove('hidden');
            
            // Scroll suave atﾃｩ a pergunta em mobile
            questionArea.scrollIntoView({ behavior: 'smooth', block: 'center' });

            const qIndex = Math.floor(Math.random() * GRAMMAR_QUESTIONS.length);
            const q = GRAMMAR_QUESTIONS[qIndex];
            questionArea.dataset.correctAnswer = q.answer;
            document.getElementById('question-text').textContent = q.question;

            const optionsDiv = document.getElementById('answer-options');
            optionsDiv.innerHTML = '';
            q.options.forEach((option, index) => {
                const optionId = `q_option_${index}`;
                optionsDiv.innerHTML += `<div><input type="radio" id="${optionId}" name="grammar_q" value="${option}" class="hidden"><label for="${optionId}" class="radio-label block text-gray-700 hover:bg-gray-100 text-sm">${option}</label></div>`;
            });
            
            document.querySelectorAll('input[name="grammar_q"]').forEach(radio => {
                radio.addEventListener('change', () => document.getElementById('submit-answer-btn').disabled = false);
            });
            document.getElementById('answer-feedback').textContent = '';
            document.getElementById('submit-answer-btn').disabled = true;
        }

        function submitGrammarAnswer() {
            if (gameState !== 'questioning') return;
            const selectedOption = document.querySelector('input[name="grammar_q"]:checked');
            const correctAnswer = document.getElementById('question-area').dataset.correctAnswer;
            const feedbackElement = document.getElementById('answer-feedback');
            
            document.getElementById('submit-answer-btn').disabled = true;
            document.querySelectorAll('input[name="grammar_q"]').forEach(radio => radio.disabled = true);

            if (selectedOption && selectedOption.value === correctAnswer) {
                feedbackElement.textContent = "笨 Correto! A disparar...";
                feedbackElement.className = "mt-4 text-center font-bold text-sm text-green-600";
                setTimeout(() => { processPlayerAttack(currentTargetCoordinate, true); resetQuestionArea(); }, 1200);
            } else {
                const answerText = selectedOption ? selectedOption.value : "Nada";
                feedbackElement.textContent = `笞ｸ Resposta Errada: ${answerText}. A correta era: ${correctAnswer}.`;
                feedbackElement.className = "mt-4 text-center font-bold text-sm text-yellow-600";
                setTimeout(() => { processPlayerAttack(currentTargetCoordinate, false); resetQuestionArea(); }, 2000);
            }
        }
        
        function resetQuestionArea() {
            const questionArea = document.getElementById('question-area');
            questionArea.classList.add('hidden');
            document.querySelectorAll('#computer-grid .grid-cell').forEach(c => c.classList.remove('disabled'));
            // Voltar scroll para o jogo
            document.getElementById('game-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function processPlayerAttack(coord, isCorrectAnswer) {
            const r = GRID_LETTERS.indexOf(coord.charAt(0));
            const c = parseInt(coord.substring(1)) - 1;
            const cell = document.getElementById(`computer-grid-${coord}`);
            cell.style.backgroundColor = ''; cell.style.border = '1px solid #bfdbfe';

            if (isCorrectAnswer) {
                const shipId = computerGrid[r][c];
                if (shipId !== null) {
                    cell.classList.add('hit'); cell.innerHTML = '徴'; cell.style.cursor = 'default';
                    const ship = computerShips.find(s => s.id === shipId);
                    ship.hits++;
                    computerGrid[r][c] = 'HIT';
                    updateGameStatus(`Acertaste em ${coord}! Joga de novo.`);
                    if (ship.hits === ship.size) {
                        ship.sunk = true;
                        updateGameStatus(`圓 Afundaste um navio em ${coord}!`);
                        computerGrid.forEach((row, r_i) => {
                            row.forEach((col, c_i) => {
                                if (col === 'HIT' && ship.coords.some(c => c.r === r_i && c.c === c_i)) {
                                    const sunkCell = document.getElementById(`computer-grid-${GRID_LETTERS[r_i]}${c_i + 1}`);
                                    if(sunkCell) { sunkCell.classList.add('sunk'); sunkCell.innerHTML = '笞'; sunkCell.classList.remove('hit'); }
                                }
                            });
                        });
                    }
                    if (checkWinCondition()) { finishGame('player'); return; }
                    gameState = 'player_turn';
                } else {
                    cell.classList.add('miss'); cell.innerHTML = '挑'; cell.style.cursor = 'default';
                    computerGrid[r][c] = 'MISS';
                    updateGameStatus(`ﾃ“ua em ${coord}. Vez do Computador.`);
                    setTimeout(computerAttack, 1000);
                }
            } else {
                // CANHﾃグ ENCRAVADO (Resposta Incorreta)
                // Nﾃ｣o marca como 'MISS' nem 'HIT'. A cﾃｩlula volta ao estado original.
                // O turno passa para o computador.
                updateGameStatus(`笞ｸ Canhﾃ｣o encravado (Resposta Errada)! O turno passa para o Computador.`);
                
                // Passa a vez
                setTimeout(computerAttack, 1500);
            }
        }

        function computerAttack() {
            gameState = 'computer_turn';
            let r, c, targetFound = false;
            while (!targetFound) {
                r = Math.floor(Math.random() * GRID_SIZE);
                c = Math.floor(Math.random() * GRID_SIZE);
                if (playerGrid[r][c] !== 'HIT' && playerGrid[r][c] !== 'MISS' && playerGrid[r][c] !== 'SUNK') targetFound = true;
            }

            const coord = GRID_LETTERS[r] + (c + 1);
            const cell = document.getElementById(`player-grid-${coord}`);
            const shipId = playerGrid[r][c];
            
            updateGameStatus(`Computador a atacar ${coord}...`);

            setTimeout(() => {
                if (shipId !== null) {
                    cell.classList.remove('ship'); cell.classList.add('hit'); cell.innerHTML = '櫨';
                    const ship = playerShips.find(s => s.id === shipId);
                    ship.hits++;
                    playerGrid[r][c] = 'HIT';
                    updateGameStatus(`櫨 Foste atingido em ${coord}!`);
                    if (ship.hits === ship.size) {
                        ship.sunk = true;
                        updateGameStatus(`笶 Perdeste um navio em ${coord}!`);
                        playerGrid.forEach((row, r_i) => {
                            row.forEach((col, c_i) => {
                                if (col === 'HIT' && ship.coords.some(c => c.r === r_i && c.c === c_i)) {
                                    const sunkCell = document.getElementById(`player-grid-${GRID_LETTERS[r_i]}${c_i + 1}`);
                                    if(sunkCell) { sunkCell.classList.add('sunk'); sunkCell.innerHTML = '笞'; sunkCell.classList.remove('hit'); }
                                }
                            });
                        });
                    }
                    if (checkWinCondition()) { finishGame('computer'); return; }
                    setTimeout(computerAttack, 1500);
                } else {
                    cell.classList.add('miss'); cell.innerHTML = '笶';
                    playerGrid[r][c] = 'MISS';
                    updateGameStatus(`O Computador falhou! Tua vez.`);
                    gameState = 'player_turn';
                }
            }, 1000);
        }

        function checkWinCondition() {
            if (playerShips.every(s => s.sunk)) return true;
            if (computerShips.every(s => s.sunk)) return true;
            return false;
        }

        function finishGame(winner) {
            gameState = 'finished';
            const btn = document.getElementById('start-game-btn');
            btn.textContent = 'Jogar de Novo';
            if (winner === 'player') {
                updateGameStatus("脂 Vitﾃｳria! Ganhaste!");
                btn.className = "bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition duration-300";
            } else {
                updateGameStatus(" Derrota. O Computador venceu.");
                btn.className = "bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition duration-300";
            }
            document.querySelectorAll('#computer-grid .grid-cell').forEach(c => c.classList.add('disabled'));
        }

        function updateGameStatus(message) {
            document.getElementById('game-status').textContent = message;
        }

        function startGame() {
            playerShips = JSON.parse(JSON.stringify(SHIP_CONFIG));
            computerShips = JSON.parse(JSON.stringify(SHIP_CONFIG));
            playerGrid = createGrid('player-grid', true);
            computerGrid = createGrid('computer-grid', false);
            placeShips(playerGrid, playerShips);
            placeShips(computerGrid, computerShips);
            renderPlayerShips(playerGrid);
            resetQuestionArea();
            document.getElementById('start-game-btn').textContent = 'Reiniciar Jogo';
            document.querySelectorAll('#computer-grid .grid-cell').forEach(c => c.classList.remove('disabled'));
            gameState = 'player_turn';
            updateGameStatus("A batalha comeﾃｧou! Toca para atacar.");
        }

        document.addEventListener('DOMContentLoaded', startGame);


        // --- Lﾃ敵ICA DO QUIZ (ZONA DE AVALIAﾃﾃグ) ---
        function normalizeAnswer(answer) {
            return answer.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim().replace(/[^a-z0-9ﾃﾃ｡ﾃｩﾃｭﾃｳﾃｺﾃ｢ﾃｪﾃｴﾃ｣ﾃｵﾃｧ ]/g, '').replace(/\s+/g, ' ');
        }

        function submitQuiz() {
            const form = document.getElementById('grammar-quiz-form');
            let earnedPoints = 0;
            let totalPoints = 0;
            let feedbackHTML = '';

            const textInputs = form.querySelectorAll('input[type="text"][data-answer]');
            textInputs.forEach(input => {
                totalPoints += parseInt(input.getAttribute('data-points'), 10);
                const correctAnswers = input.getAttribute('data-answer').split(',').map(ans => normalizeAnswer(ans));
                const userAnswer = normalizeAnswer(input.value);
                const points = parseInt(input.getAttribute('data-points'), 10);
                const row = input.closest('tr') || input.closest('.flex');

                input.classList.remove('correct', 'incorrect');
                if (row) row.classList.remove('table-feedback-correct', 'table-feedback-incorrect');

                if (correctAnswers.includes(userAnswer) && userAnswer !== "") {
                    earnedPoints += points;
                    input.classList.add('correct');
                    if (row) row.classList.add('table-feedback-correct');
                } else if (input.value.trim() !== "") {
                    input.classList.add('incorrect');
                    if (row) row.classList.add('table-feedback-incorrect');
                    
                    let questionText = 'Questﾃ｣o';
                    if (row && row.querySelector('label')) questionText = row.querySelector('label').textContent.replace(':','').trim();
                    else if (row && row.querySelector('td')) questionText = row.querySelector('td').textContent.trim();
                    else if (input.placeholder) questionText = input.placeholder;

                    const correctDisplay = input.getAttribute('data-answer').replace(/,/g, ' ou ');
                    feedbackHTML += `<div class="p-3 border-l-4 border-red-500 bg-red-50 text-sm"><p class="font-bold text-red-700">笶 ${questionText}</p><p class="text-gray-700">Tu: <span class="font-mono text-red-600">${input.value}</span> | Correto: <span class="font-mono text-green-600">${correctDisplay}</span></p></div>`;
                }
            });

            // Radio Logic (Same as before but optimized)
            const radioGroupNames = ['q4_a', 'q4_b', 'q4_c', 'q4_d', 'q5_a', 'q5_b', 'q5_c', 'q5_d', 'q5_e', 'q5_f', 'q5_g', 'q5_h'];
            radioGroupNames.forEach(groupName => {
                const checkedRadio = form.querySelector(`input[name="${groupName}"]:checked`);
                const answerRadio = form.querySelector(`input[name="${groupName}"][data-answer]`);
                
                if (answerRadio) {
                    totalPoints += parseInt(answerRadio.getAttribute('data-points'), 10);
                    // Reset visuals
                    document.querySelectorAll(`input[name="${groupName}"]`).forEach(r => {
                        if(r.parentElement.classList.contains('radio-label')) {
                            r.parentElement.style.backgroundColor = '';
                            r.parentElement.style.color = '';
                            r.parentElement.style.borderColor = '';
                        }
                    });
                }

                if (checkedRadio) {
                    const userAnswer = checkedRadio.value;
                    const correctAnswer = answerRadio ? normalizeAnswer(answerRadio.getAttribute('data-answer')) : '';
                    const points = answerRadio ? parseInt(answerRadio.getAttribute('data-points'), 10) : 0;
                    const labelElement = checkedRadio.parentElement;

                    if (normalizeAnswer(userAnswer) === correctAnswer) {
                        earnedPoints += points;
                        if(labelElement.classList.contains('radio-label')) {
                            labelElement.style.backgroundColor = '#10b981';
                            labelElement.style.color = 'white';
                            labelElement.style.borderColor = '#059669';
                        }
                    } else {
                        if(labelElement.classList.contains('radio-label')) {
                            labelElement.style.backgroundColor = '#fef2f2';
                            labelElement.style.borderColor = '#f87171';
                        }
                        // Highlight correct one
                        if(answerRadio && answerRadio.parentElement.classList.contains('radio-label')) {
                            answerRadio.parentElement.style.backgroundColor = '#d1fae5';
                            answerRadio.parentElement.style.borderColor = '#34d399';
                        }
                        
                        let qText = "Pergunta de escolha mﾃｺltipla";
                        const container = checkedRadio.closest('.rounded-lg') || checkedRadio.closest('tr');
                        if(container.querySelector('p')) qText = container.querySelector('p').textContent;
                        else if(container.querySelector('td')) qText = container.querySelector('td').textContent;

                        const correctLabelText = answerRadio ? answerRadio.parentElement.textContent.trim() : 'N/A';
                        feedbackHTML += `<div class="p-3 border-l-4 border-red-500 bg-red-50 text-sm"><p class="font-bold text-red-700">笶 ${qText}</p><p class="text-gray-700">Tu: <span class="font-mono text-red-600">${labelElement.textContent.trim()}</span> | Correto: <span class="font-mono text-green-600">${correctLabelText}</span></p></div>`;
                    }
                }
            });

            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('submit-button').disabled = true;
            document.getElementById('submit-button').textContent = "Correﾃｧﾃ｣o Finalizada";

            const scoreSummary = document.getElementById('score-summary');
            const detailedFeedback = document.getElementById('detailed-feedback');
            const scorePercentage = totalPoints > 0 ? (earnedPoints / totalPoints) * 100 : 0;
            let resultClass = scorePercentage >= 50 ? 'bg-green-50 text-green-800 border-green-500' : 'bg-red-50 text-red-800 border-red-500';

            scoreSummary.className = `p-4 text-center rounded-lg mb-6 border-l-4 ${resultClass}`;
            scoreSummary.innerHTML = `<p class="text-xl font-bold">${earnedPoints} / ${totalPoints} Pontos</p><p class="text-3xl font-extrabold my-2">${scorePercentage.toFixed(0)}%</p>`;
            detailedFeedback.innerHTML = feedbackHTML === '' ? '<p class="text-center text-green-600 font-bold">脂 Parabﾃｩns! Tudo certo!</p>' : feedbackHTML;
            
            // Scroll para resultados
            document.getElementById('quiz-results').scrollIntoView({ behavior: 'smooth' });
        }

        function resetQuiz() {
            document.getElementById('grammar-quiz-form').reset();
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('submit-button').disabled = false;
            document.getElementById('submit-button').textContent = "Submeter Avaliaﾃｧﾃ｣o";
            
            document.querySelectorAll('.input-text').forEach(input => input.classList.remove('correct', 'incorrect'));
            document.querySelectorAll('.radio-label').forEach(label => { 
                label.style.backgroundColor = ''; 
                label.style.color = ''; 
                label.style.borderColor = '#d1d5db'; 
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
